var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});(function(){"use strict";function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}__name(getDefaultExportFromCjs,"getDefaultExportFromCjs");var ringbufferjs,hasRequiredRingbufferjs;function requireRingbufferjs(){if(hasRequiredRingbufferjs)return ringbufferjs;hasRequiredRingbufferjs=1,ringbufferjs=RingBuffer2;function RingBuffer2(capacity,evictedCb){this._elements=new Array(capacity||50),this._first=0,this._last=0,this._size=0,this._evictedCb=evictedCb}return __name(RingBuffer2,"RingBuffer"),RingBuffer2.prototype.capacity=function(){return this._elements.length},RingBuffer2.prototype.isEmpty=function(){return this.size()===0},RingBuffer2.prototype.isFull=function(){return this.size()===this.capacity()},RingBuffer2.prototype.peek=function(){if(this.isEmpty())throw new Error("RingBuffer is empty");return this._elements[this._first]},RingBuffer2.prototype.peekN=function(count){if(count>this._size)throw new Error("Not enough elements in RingBuffer");var end=Math.min(this._first+count,this.capacity()),firstHalf=this._elements.slice(this._first,end);if(end<this.capacity())return firstHalf;var secondHalf=this._elements.slice(0,count-firstHalf.length);return firstHalf.concat(secondHalf)},RingBuffer2.prototype.deq=function(){var element=this.peek();return this._size--,this._first=(this._first+1)%this.capacity(),element},RingBuffer2.prototype.deqN=function(count){var elements=this.peekN(count);return this._size-=count,this._first=(this._first+count)%this.capacity(),elements},RingBuffer2.prototype.enq=function(element){this._end=(this._first+this.size())%this.capacity();var full=this.isFull();return full&&this._evictedCb&&this._evictedCb(this._elements[this._end]),this._elements[this._end]=element,full?this._first=(this._first+1)%this.capacity():this._size++,this.size()},RingBuffer2.prototype.size=function(){return this._size},ringbufferjs}__name(requireRingbufferjs,"requireRingbufferjs");var ringbufferjsExports=requireRingbufferjs(),RingBuffer=getDefaultExportFromCjs(ringbufferjsExports),config={AUDIO_BUFFER_SIZE:4096};const _PlayerWorklet=class _PlayerWorklet extends AudioWorkletProcessor{constructor(){super(),this.buffer=new RingBuffer(config.AUDIO_BUFFER_SIZE),this.port.onmessage=event=>{for(let sample of event.data)this.buffer.enq(sample)}}process(inputs,outputs){const output=outputs[0][0],size=output.length;try{const samples=this.buffer.deqN(size);for(let i=0;i<size;i++)output[i]=samples[i]}catch{for(let i=0;i<size;i++)output[i]=0}return this.port.postMessage({need:size,have:this.buffer.size()}),!0}};__name(_PlayerWorklet,"PlayerWorklet");let PlayerWorklet=_PlayerWorklet;registerProcessor("player-worklet",PlayerWorklet)})();
